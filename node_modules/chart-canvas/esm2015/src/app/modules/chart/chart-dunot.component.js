import { Component, ViewChild, Input } from '@angular/core';
import { UtilChart } from './util.chart';
export class ChartDunotComponent extends UtilChart {
    constructor() {
        super(...arguments);
        this.data = {};
        this.colors = [];
        this.doughnutHoleSize = 0.5;
    }
    ngAfterViewInit() {
        let canvasEl = this.canvas.nativeElement;
        let ctx = canvasEl.getContext('2d');
        let total_value = 0;
        let color_index = 0;
        for (var categ in this.data) {
            var val = this.data[categ];
            total_value += val;
        }
        let start_angle = 0;
        for (categ in this.data) {
            val = this.data[categ];
            var slice_angle = (2 * Math.PI * val) / total_value;
            let widthCanvas = canvasEl.width / 2;
            let heightCanvas = canvasEl.height / 2;
            this.drawPieSlice(ctx, widthCanvas, heightCanvas, Math.min(widthCanvas, heightCanvas), start_angle, start_angle + slice_angle, this.colors[color_index % this.colors.length]);
            start_angle += slice_angle;
            color_index++;
        }
        //to create the doughnut chart
        this.drawPieSlice(ctx, canvasEl.width / 2, canvasEl.height / 2, this.doughnutHoleSize * Math.min(canvasEl.width / 2, canvasEl.height / 2), 0, 2 * Math.PI, '#fff');
        for (categ in this.data) {
            val = this.data[categ];
            slice_angle = (2 * Math.PI * val) / total_value;
            let pieRadius = Math.min(canvasEl.width / 2, canvasEl.height / 2);
            //to create the doughnut chart
            let offset = (pieRadius * this.doughnutHoleSize) / 2;
            let offsetPieRadius = offset + pieRadius / 2;
            let labelX = canvasEl.width / 2 + (offsetPieRadius) * Math.cos(start_angle + slice_angle / 2);
            let labelY = canvasEl.height / 2 + (offsetPieRadius) * Math.sin(start_angle + slice_angle / 2);
            let labelText = Math.round((100 * val) / total_value);
            if (labelText > 0) {
                ctx.fillStyle = 'white';
                ctx.font = 'bold 1em Arial';
                ctx.fillText(labelText + '%', labelX, labelY);
            }
            start_angle += slice_angle;
        }
        if (this.legend) {
            color_index = 0;
            let legendHTML = '';
            for (categ in this.data) {
                legendHTML +=
                    "<div><span style='display:inline-block;width:20px;background-color:" +
                        this.colors[color_index++] +
                        ";'>&nbsp;</span> " +
                        categ +
                        '</div>';
            }
            this.legend.nativeElement.innerHTML = legendHTML;
        }
    }
}
ChartDunotComponent.decorators = [
    { type: Component, args: [{
                selector: 'canvas-chart-dunot',
                template: `
           <div style='display: flex;flex-wrap: nowrap;'>
                <canvas #canvas></canvas>
                <div #legend></div>
           </div>
    `
            },] }
];
ChartDunotComponent.propDecorators = {
    canvas: [{ type: ViewChild, args: ['canvas',] }],
    legend: [{ type: ViewChild, args: ['legend',] }],
    data: [{ type: Input }],
    colors: [{ type: Input }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcnQtZHVub3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2FwcC9tb2R1bGVzL2NoYXJ0L2NoYXJ0LWR1bm90LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUE2QixTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFXekMsTUFBTSxPQUFPLG1CQUFvQixTQUFRLFNBQVM7SUFUbEQ7O1FBZ0JFLFNBQUksR0FBUSxFQUFFLENBQUM7UUFFZixXQUFNLEdBQWEsRUFBRSxDQUFDO1FBQ2QscUJBQWdCLEdBQVcsR0FBRyxDQUFDO0lBZ0Z6QyxDQUFDO0lBOUVDLGVBQWU7UUFDYixJQUFJLFFBQVEsR0FBc0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7UUFDNUQsSUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVwQyxJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7UUFDcEIsSUFBSSxXQUFXLEdBQUcsQ0FBQyxDQUFDO1FBQ3BCLEtBQUssSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUMzQixJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNCLFdBQVcsSUFBSSxHQUFHLENBQUM7U0FDcEI7UUFFRCxJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7UUFDcEIsS0FBSyxLQUFLLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUN2QixHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN2QixJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxH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Qzt3QkFDMUIsbUJBQW1CO3dCQUNuQixLQUFLO3dCQUNMLFFBQVEsQ0FBQzthQUNaO1lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQztTQUNsRDtJQUNILENBQUM7OztZQWxHRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLG9CQUFvQjtnQkFDOUIsUUFBUSxFQUFFOzs7OztLQUtQO2FBQ0o7OztxQkFFRSxTQUFTLFNBQUMsUUFBUTtxQkFFbEIsU0FBUyxTQUFDLFFBQVE7bUJBR2xCLEtBQUs7cUJBRUwsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQWZ0ZXJWaWV3SW5pdCwgRWxlbWVudFJlZiwgVmlld0NoaWxkLCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBVdGlsQ2hhcnQgfSBmcm9tICcuL3V0aWwuY2hhcnQnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdjYW52YXMtY2hhcnQtZHVub3QnLFxyXG4gIHRlbXBsYXRlOiBgXHJcbiAgICAgICAgICAgPGRpdiBzdHlsZT0nZGlzcGxheTogZmxleDtmbGV4LXdyYXA6IG5vd3JhcDsnPlxyXG4gICAgICAgICAgICAgICAgPGNhbnZhcyAjY2FudmFzPjwvY2FudmFzPlxyXG4gICAgICAgICAgICAgICAgPGRpdiAjbGVnZW5kPjwvZGl2PlxyXG4gICAgICAgICAgIDwvZGl2PlxyXG4gICAgYFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQ2hhcnREdW5vdENvbXBvbmVudCBleHRlbmRzIFV0aWxDaGFydCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xyXG4gIEBWaWV3Q2hpbGQoJ2NhbnZhcycpXHJcbiAgcHVibGljIGNhbnZhczogRWxlbWVudFJlZjtcclxuICBAVmlld0NoaWxkKCdsZWdlbmQnKVxyXG4gIHB1YmxpYyBsZWdlbmQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gIEBJbnB1dCgpXHJcbiAgZGF0YTogYW55ID0ge307XHJcbiAgQElucHV0KClcclxuICBjb2xvcnM6IHN0cmluZ1tdID0gW107XHJcbiAgcHJpdmF0ZSBkb3VnaG51dEhvbGVTaXplOiBudW1iZXIgPSAwLjU7XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIGxldCBjYW52YXNFbDogSFRNTENhbnZhc0VsZW1lbnQgPSB0aGlzLmNhbnZhcy5uYXRpdmVFbGVtZW50O1xyXG4gICAgbGV0IGN0eCA9IGNhbnZhc0VsLmdldENvbnRleHQoJzJkJyk7XHJcblxyXG4gICAgbGV0IHRvdGFsX3ZhbHVlID0gMDtcclxuICAgIGxldCBjb2xvcl9pbmRleCA9IDA7XHJcbiAgICBmb3IgKHZhciBjYXRlZyBpbiB0aGlzLmRhdGEpIHtcclxuICAgICAgdmFyIHZhbCA9IHRoaXMuZGF0YVtjYXRlZ107XHJcbiAgICAgIHRvdGFsX3ZhbHVlICs9IHZhbDtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgc3RhcnRfYW5nbGUgPSAwO1xyXG4gICAgZm9yIChjYXRlZyBpbiB0aGlzLmRhdGEpIHtcclxuICAgICAgdmFsID0gdGhpcy5kYXRhW2NhdGVnXTtcclxuICAgICAgdmFyIHNsaWNlX2FuZ2xlID0gKDIgKiBNYXRoLlBJICogdmFsKSAvIHRvdGFsX3ZhbHVlO1xyXG5cclxuICAgICAgbGV0IHdpZHRoQ2FudmFzID0gY2FudmFzRWwud2lkdGggLyAyO1xyXG4gICAgICBsZXQgaGVpZ2h0Q2FudmFzID0gY2FudmFzRWwuaGVpZ2h0IC8gMjtcclxuXHJcbiAgICAgIHRoaXMuZHJhd1BpZVNsaWNlKFxyXG4gICAgICAgIGN0eCxcclxuICAgICAgICB3aWR0aENhbnZhcyxcclxuICAgICAgICBoZWlnaHRDYW52YXMsXHJcbiAgICAgICAgTWF0aC5taW4od2lkdGhDYW52YXMsIGhlaWdodENhbnZhcyksXHJcbiAgICAgICAgc3RhcnRfYW5nbGUsXHJcbiAgICAgICAgc3RhcnRfYW5nbGUgKyBzbGljZV9hbmdsZSxcclxuICAgICAgICB0aGlzLmNvbG9yc1tjb2xvcl9pbmRleCAlIHRoaXMuY29sb3JzLmxlbmd0aF1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHN0YXJ0X2FuZ2xlICs9IHNsaWNlX2FuZ2xlO1xyXG4gICAgICBjb2xvcl9pbmRleCsrO1xyXG4gICAgfVxyXG5cclxuICAgIC8vdG8gY3JlYXRlIHRoZSBkb3VnaG51dCBjaGFydFxyXG4gICAgdGhpcy5kcmF3UGllU2xpY2UoXHJcbiAgICAgIGN0eCxcclxuICAgICAgY2FudmFzRWwud2lkdGggLyAyLFxyXG4gICAgICBjYW52YXNFbC5oZWlnaHQgLyAyLFxyXG4gICAgICB0aGlzLmRvdWdobnV0SG9sZVNpemUgKiBNYXRoLm1pbihjYW52YXNFbC53aWR0aCAvIDIsIGNhbnZhc0VsLmhlaWdodCAvIDIpLFxyXG4gICAgICAwLFxyXG4gICAgICAyICogTWF0aC5QSSxcclxuICAgICAgJyNmZmYnXHJcbiAgICApO1xyXG5cclxuICAgIGZvciAoY2F0ZWcgaW4gdGhpcy5kYXRhKSB7XHJcbiAgICAgIHZhbCA9IHRoaXMuZGF0YVtjYXRlZ107XHJcbiAgICAgIHNsaWNlX2FuZ2xlID0gKDIgKiBNYXRoLlBJICogdmFsKSAvIHRvdGFsX3ZhbHVlO1xyXG4gICAgICBsZXQgcGllUmFkaXVzID0gTWF0aC5taW4oY2FudmFzRWwud2lkdGggLyAyLCBjYW52YXNFbC5oZWlnaHQgLyAyKTtcclxuXHJcbiAgICAgIC8vdG8gY3JlYXRlIHRoZSBkb3VnaG51dCBjaGFydFxyXG4gICAgICBsZXQgb2Zmc2V0ID0gKHBpZVJhZGl1cyAqIHRoaXMuZG91Z2hudXRIb2xlU2l6ZSkgLyAyO1xyXG4gICAgICBsZXQgb2Zmc2V0UGllUmFkaXVzID0gb2Zmc2V0ICsgcGllUmFkaXVzIC8gMjtcclxuICAgICAgbGV0IGxhYmVsWCA9IGNhbnZhc0VsLndpZHRoIC8gMiArIChvZmZzZXRQaWVSYWRpdXMpICogTWF0aC5jb3Moc3RhcnRfYW5nbGUgKyBzbGljZV9hbmdsZSAvIDIpO1xyXG4gICAgICBsZXQgbGFiZWxZID0gY2FudmFzRWwuaGVpZ2h0IC8gMiArIChvZmZzZXRQaWVSYWRpdXMpICogTWF0aC5zaW4oc3RhcnRfYW5nbGUgKyBzbGljZV9hbmdsZSAvIDIpO1xyXG5cclxuICAgICAgbGV0IGxhYmVsVGV4dCA9IE1hdGgucm91bmQoKDEwMCAqIHZhbCkgLyB0b3RhbF92YWx1ZSk7XHJcbiAgICAgIGlmIChsYWJlbFRleHQgPiAwKSB7XHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICd3aGl0ZSc7XHJcbiAgICAgICAgY3R4LmZvbnQgPSAnYm9sZCAxZW0gQXJpYWwnO1xyXG4gICAgICAgIGN0eC5maWxsVGV4dChsYWJlbFRleHQgKyAnJScsIGxhYmVsWCwgbGFiZWxZKTtcclxuICAgICAgfVxyXG4gICAgICBzdGFydF9hbmdsZSArPSBzbGljZV9hbmdsZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5sZWdlbmQpIHtcclxuICAgICAgY29sb3JfaW5kZXggPSAwO1xyXG4gICAgICBsZXQgbGVnZW5kSFRNTCA9ICcnO1xyXG4gICAgICBmb3IgKGNhdGVnIGluIHRoaXMuZGF0YSkge1xyXG4gICAgICAgIGxlZ2VuZEhUTUwgKz1cclxuICAgICAgICAgIFwiPGRpdj48c3BhbiBzdHlsZT0nZGlzcGxheTppbmxpbmUtYmxvY2s7d2lkdGg6MjBweDtiYWNrZ3JvdW5kLWNvbG9yOlwiICtcclxuICAgICAgICAgIHRoaXMuY29sb3JzW2NvbG9yX2luZGV4KytdICtcclxuICAgICAgICAgIFwiOyc+Jm5ic3A7PC9zcGFuPiBcIiArXHJcbiAgICAgICAgICBjYXRlZyArXHJcbiAgICAgICAgICAnPC9kaXY+JztcclxuICAgICAgfVxyXG4gICAgICB0aGlzLmxlZ2VuZC5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IGxlZ2VuZEhUTUw7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==